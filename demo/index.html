<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Map generation demo</title>
    <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body>
    <div id="main">
      <h1>Map generation<small> - work in progress</small></h1>
      <div class="panel">
        <pre class="info">&gt;<span id="position"></span></pre>
      </div>
      <div id="content">
        <div id="menu" class="panel">
          <button id="toggleRooms">Show/hide rooms bounding boxes</button>
          <button id="togglePathes">Show/hide pathes</button>
          <button id="toggleRoomLimits" disabled>Show/hide rooms frontiers</button>
          <h2>Options</h2>
          <div class="accordion">
            <div class="menu-button">Map generation</div>
            <div class="menu-content">
              description of this
              x,
              y,
              passes,
              cleanLevel,
              wallPercent,
              sameSubCellPercent,
            </div>

            <div class="menu-button">Map cleaning</div>
            <div class="menu-content">
              minRoomSize,
              description of this
            </div>

            <div class="menu-button">Content: general options</div>
            <div class="menu-content">
              placeLivingThings:true,
              placeDeadThings:true,
            </div>

            <div class="menu-button">Content: enemies</div>
            <div class="menu-content">
              createEnnemies:true,
              ennemiesPercent:10,
              createBoss:true,
            </div>

            <div class="menu-button">Content: items</div>
            <div class="menu-content">
              createLifePotions:true,
              lifePotionsMapPercent:2,
              createStrenghtTokens:true,
              createDamageTokens:true,
              strenghtTokenMapPercent:3,
              damageTokenMapPercent:3,
              placeObjectsOnDamagingCells:true,
            </div>

            <div class="menu-button">Debug</div>
            <div class="menu-content">
              drawRooms:true,
              drawPathes:true,
              useSample:false,
            </div>
            <!-- Menu entry snippet
            <div class="menu-button"></div>
            <div class="menu-content">
            </div>
            -->
          </div>
          <button id="mapReGenerate">Re-generate !</button>
        </div>

        <div id="grid" class="panel">
          <div id="rooms"></div>
          <!-- Canva for pathes will go here -->
        </div>
      </div>

<pre>
  [X] - Generating random map
  [X] - Cleaning up the map (isolated 1x1 cells)
  [X] - Find rooms
  [X] - Extra room cleanup (remove small rooms)
  [X] - Find rooms boundaries
  [X] - Find all possible pathes (from rooms virtual centers)
  [ ] - Create pathes between rooms
  [X] - Place random objects
  [X] - Render the map
</pre>
  </div>

    <script src="https://code.jquery.com/jquery-1.12.3.min.js" integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>
    <script src="../js/mapgen.js" type="text/javascript"></script>
    <script src="../js/mapgen-objects.js" type="text/javascript"></script>
    <script src="../js/mapgen-privates.js" type="text/javascript"></script>
    <script src="../js/mapgen-methods.js" type="text/javascript"></script>
    <script src="../js/demo_functions.js" type="text/javascript"></script>
    <script src="../js/demo_base_objects.js" type="text/javascript"></script>
    <script src="../js/demo_room_samples.js" type="text/javascript"></script>
    <!--<script src="../build.js" type="text/javascript"></script>
    <script src="../build-demo.js" type="text/javascript"></script>-->
    <script type="text/javascript">

    var map=null;
    var options={
      // Options for the map generator
      mapOptions:{
        x:5,
        y:5,
        passes:3,
        cleanLevel: 5,
        wallPercent:30,
        // Cell types are defined in demo.js
        cellTypes: cellTypes,
      }
    }

    createAndRenderMap(options);


    /***************************************************************************
      JQuery
    */
    $('#rooms').hide();
    $('#map-pathes').hide();
    /**
      Events on buttons
    */
    $('#toggleRooms').click(function(){
      $('#rooms').toggle();
    })
    $('#togglePathes').click(function(){
      $('#map-pathes').toggle();
    })

    $('.map-cell').hover(function(a){
      $('#position').text($(this).attr('class'))
    });

    // Tooltips. (base from http://www.alessioatzeni.com/blog/simple-tooltip-with-jquery-only-text/)
    $(document).ready(function() {
      // Tooltip only Text
      $('.map-cell').hover(function(){
        // Hover over code
        var cellId = $(this).attr('title');
        var content='Cell :'+displayData(map.cells[cellId])+'Content:' +displayData(map.items[map.getCellContent(cellId)]);
        $(this).data('tipText', cellId).removeAttr('title');
        $('<p class="tooltip"></p>').html(content).appendTo('body').fadeIn('slow');}, function() {
          // Hover out code
          $(this).attr('title', $(this).data('tipText'));
          $('.tooltip').remove();
        }).mousemove(function(e) {
          var mousex = e.pageX + 20; //Get X coordinates
          var mousey = e.pageY + 10; //Get Y coordinates
          $('.tooltip').css({ top: mousey, left: mousex });
        });

        // Accordion, code found here : http://www.stemkoski.com/stupid-simple-jquery-accordion-menu/
        jQuery(function() {
        	jQuery('.menu-button').on('click',function() {
        		jQuery('.menu-content').slideUp('fast');
        		jQuery(this).next('.menu-content').slideDown('fast');
        	});
        });
      });
    </script>
  </body>
</html>
